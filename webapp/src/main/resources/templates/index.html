<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LOGIN</title>
    <link rel="stylesheet" type="text/css" href="../css/login/login.css"/>
    <script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        var token = null;
        function ajaxSubmit(){
            var userInfo={
                'loginName':$("*[name='loginName']").val(),
                'password':$("*[name='password']").val()
            };
            $.ajax({
                type: "post",
                url: "/login/getToken",
                dataType: "JSON",
                data: userInfo,
                async: true,
                success:function(data, textStatus, jqXHR){
                    console.log(jqXHR.getAllResponseHeaders());
                    if(data.code.toString() == 200){
                        token = jqXHR.getResponseHeader("token");
                        if(token == null){
                            alert("系统异常，token生成失败，重新登陆！");
                            return;
                        }else{
                            localStorage.setItem("token",token)  //本地存储token的值
                        }
                        window.location.href="/course/courseList.html";
                    }
                },
                error:function (XMLHttpRequest, textStatus, errorThrown){
                    console.log(XMLHttpRequest.getAllResponseHeaders());
                    if(textStatus=="timeout"){
                        alert("响应超时，请稍后重试");
                    }else{
                        alert("用户名或者密码错误！");
                    }
                }
            });

        }
        function func(token) {
            $.ajax({
                type: 'GET',
                url:  '/test',
                beforeSend : function (xhr) {
                    xhr.setRequestHeader("Authorization","Bearer"+token)
                },
                cache : false,
                dataType: 'html',
                data: {},
                success:function( data,status,xhr ){
                    console.log(xhr.getAllResponseHeaders());
                },
                error:function(){
                    alert("error!!!!");
                }
            });
        }
    </script>
</head>
<body>
<a id="register" href="/views/register.html">REGISTER</a>
<span class="login_form"  id="loginForm">
    <div class="content">
        <p2><div id="header" >SIGN IN</div></p2>
        <div id="d1" >loginName<a id="a1">： <input type="text" name="loginName"></a></div>
        <div id="d2" >password<a id="a2">： <input type="password" name="password" > </a></div>
        <div id="d3" > <button id="b1" onclick="ajaxSubmit()">LOGIN</button>  <button id="b2" type="reset">RESET</button></div>
    </div>
</span>
</body>
</html>